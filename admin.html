<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Admin ‚Äî Ifaz Travels</title>

  <!-- v8 promo styles so the preview looks same as site -->
  <link rel="stylesheet" href="promo.css?v=8">

  <style>
    :root{
      --brand:#0ea5e9; --brand-dark:#0284c7;
      --border:#e5e7eb; --text:#0f172a; --muted:#64748b;
      --ok:#16a34a; --danger:#ef4444;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:'Hind Siliguri','Noto Sans Bengali',system-ui,sans-serif;color:var(--text);background:#f6faff}
    header{background:#fff;border-bottom:1px solid var(--border);position:sticky;top:0;z-index:20}
    .container{max-width:1100px;margin:0 auto;padding:0 16px}
    .nav{display:flex;justify-content:space-between;align-items:center;padding:12px 0}
    .brand{font-weight:900;display:flex;align-items:center;gap:8px}
    .tag{font-size:12px;background:#e0f2fe;border:1px solid #bae6fd;color:#0369a1;padding:2px 8px;border-radius:999px}

    .wrap{max-width:1100px;margin:20px auto;padding:0 16px}
    .card{background:#fff;border:1px solid var(--border);border-radius:14px;padding:16px;box-shadow:0 8px 24px rgba(2,8,23,.06);margin-bottom:18px}
    h2{margin:0 0 10px;font-size:22px}
    .hint{color:var(--muted);font-weight:700}

    .btn{padding:9px 12px;border-radius:10px;border:1px solid var(--border);background:#fff;font-weight:800;cursor:pointer}
    .btn.primary{background:var(--brand);border-color:var(--brand);color:#fff}
    .btn.danger{background:#fee2e2;border-color:#fecaca;color:#991b1b}
    .btn.link{background:transparent;border:none;color:var(--brand);text-decoration:underline}
    .btn.ghost{background:#f8fafc}

    table{width:100%;border-collapse:separate;border-spacing:0 8px}
    th,td{padding:10px;vertical-align:top}
    thead th{color:#0f172a;text-align:left}
    tbody tr{background:#fafcff;border:1px solid #ecf3fb}
    tbody tr td:first-child, thead tr th:first-child{border-radius:10px 0 0 10px}
    tbody tr td:last-child, thead tr th:last-child{border-radius:0 10px 10px 0}

    input[type="text"], input[type="url"]{width:100%;padding:10px;border:1px solid var(--border);border-radius:10px}
    select{padding:10px;border:1px solid var(--border);border-radius:10px}
    .row-actions{display:flex;gap:8px}
    .foot-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:12px;flex-wrap:wrap}

    /* Promo preview should feel big like site */
    #promo-slot.promo-wrap{margin-top:4px !important}
    .preview-note{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .mini{font-size:12px;color:var(--muted)}
    .grid-preview{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
    .pkg-card{background:#fafcff;border:1px dashed #dbeafe;border-radius:12px;padding:14px}
    .pkg-card h4{margin:0 0 6px}
    .pkg-card .price{font-weight:800}
    .pkg-card .note{color:#475569;margin:2px 0 10px}
    .pkg-card .btn{background:#334155;color:#fff;border-color:#334155}

    @media(max-width:768px){
      table{display:block;overflow-x:auto;white-space:nowrap}
    }
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <div class="brand">üõ†Ô∏è Ifaz Admin <span class="tag">v8</span></div>
      <div>
        <button class="btn link" onclick="location.href='index.html'">‚Üê Back to site</button>
        <button class="btn" id="logoutBtn">Logout</button>
      </div>
    </div>
  </header>

  <div class="wrap">

    <!-- Promo preview -->
    <div class="card">
      <div class="preview-note">
        <h2>Promo Preview</h2>
        <div class="mini">* ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶∏‡¶æ‡¶á‡¶ü‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶π‡ßü (promo.css/js v8)</div>
      </div>
      <script defer src="promo.js?v=8"></script>
<!-- (‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® JS ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á ‡¶•‡¶æ‡¶ï‡¶¨‡ßá) -->
    </div>

    <!-- Manage Promos -->
    <div class="card">
      <h2>Manage Promos</h2>
      <div class="hint">‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶∏‡ßç‡¶≤‡¶æ‡¶á‡¶°‡•§ Theme: sky / blue / rose / amber / green / lime ¬∑ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßá <b>Save Promos</b> ‡¶¶‡¶ø‡¶®‡•§</div>
      <table id="promoTable">
        <thead>
          <tr>
            <th>Title</th><th>Subtitle</th><th>Badge</th><th>Theme</th><th>Link</th><th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div class="foot-actions">
        <button class="btn ghost" id="addPromo">+ Add Promo</button>
        <button class="btn danger" id="resetPromo">Reset Defaults</button>
        <button class="btn primary" id="savePromo">Save Promos</button>
      </div>
    </div>

    <!-- Manage Packages -->
    <div class="card">
      <h2>Manage Packages</h2>
      <div class="hint">‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ / Price / Note / CTA text + link ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶® ‚Üí <b>Save Packages</b>.</div>
      <table id="pkgTable">
        <thead>
          <tr>
            <th>Title</th><th>Price</th><th>Note</th><th>CTA Text</th><th>CTA Link</th><th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div class="foot-actions">
        <button class="btn ghost" id="addPkg">+ Add Package</button>
        <button class="btn danger" id="resetPkg">Reset Defaults</button>
        <button class="btn primary" id="savePkg">Save Packages</button>
      </div>

      <!-- Small local preview of packages -->
      <div style="margin-top:14px">
        <div class="preview-note">
          <strong>Packages Preview</strong>
          <span class="mini">* ‡¶π‡ßã‡¶Æ‡¶™‡ßá‡¶ú‡ßá‡¶∞ ‚Äú‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ú ‡¶∏‡¶Æ‡ßÇ‡¶π‚Äù ‡¶Ö‡¶Ç‡¶∂‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã ‡¶ï‡¶æ‡¶∞‡ßç‡¶°</span>
        </div>
        <div class="grid-preview" id="pkgPreview"></div>
      </div>
    </div>
  </div>

  <!-- v8 promo runtime -->
  <script defer src="promo.js?v=8"></script>

  <script>
    // -------- Login guard ----------
    (function(){
      if(localStorage.getItem('ifaz_auth')!=='1'){
        window.location.replace('index.html');
      }
    })();

    // -------- Keys (must match site) ----------
    const PROMO_KEY = 'ifaz_promos_v1';
    const PKG_KEY   = 'ifaz_packages_v1';

    // -------- Defaults ----------
    const defaultPromos = [
      { title:'Dhaka ‚Üí Jeddah Air Ticket',  subtitle:'Lowest Price ‚Ä¢ Book Now',              badge:'Hot',    theme:'sky',   href:'contact.html' },
      { title:'China Visa',                  subtitle:'No Visa ‚Ä¢ No Fee',                    badge:'Visa',   theme:'rose',  href:'contact.html' },
      { title:'Domestic Air Ticket',         subtitle:'Flat 5% Discount',                    badge:'Deal',   theme:'amber', href:'contact.html' },
      { title:'Malaysia Visa',               subtitle:'Fast Processing ‚Ä¢ Tourist/Business',  badge:'New',    theme:'green', href:'contact.html' },
      { title:'Hajj Pre-Registration',       subtitle:'‡¶∏‡¶π‡¶ú ‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡ßü‡¶æ ‚Ä¢ ‡¶∏‡ßÄ‡¶Æ‡¶ø‡¶§ ‡¶Ü‡¶∏‡¶®',           badge:'Hajj',   theme:'blue',  href:'contact.html' },
      { title:'GAMCA Medical Slip',          subtitle:'Instant e-Slip ‚Ä¢ Verified',           badge:'Work',   theme:'lime',  href:'contact.html' },
      { title:'‡ßß ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü‡ßá ‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø',           subtitle:'Visa / Slip PDF ‚Üí WhatsApp',         badge:'Instant',theme:'sky',   href:'https://api.whatsapp.com/send?phone=8801712055858' },
    ];

    const defaultPackages = [
      { title:'‚úàÔ∏è ‡ß≠ ‡¶¶‡¶ø‡¶®', price:'Call for Price',        note:'Visa, Ticket, Hotel, Transport',  ctaText:'Get Quote',   ctaHref:'#booking-form' },
      { title:'üïå ‡ßß‡ß¶ ‡¶¶‡¶ø‡¶®', price:'Call for Price',        note:'Group / Family rooms',            ctaText:'Get Quote',   ctaHref:'#booking-form' },
      { title:'üè® ‡ßß‡ß™ ‡¶¶‡¶ø‡¶®', price:'‡ß≥‡ßß,‡ß™‡ß´‡ß¶‡ß¶‡ß¶',              note:'‡¶ñ‡¶æ‡¶¨‡¶æ‡¶∞ ‡¶õ‡¶æ‡ßú‡¶æ ¬∑ Near Haram',        ctaText:'Get Quote',   ctaHref:'#booking-form' },
      { title:'üìÖ October 2025 (Group)', price:'Early-bird available', note:'19 Oct departure ¬∑ Guide included', ctaText:'Reserve', ctaHref:'#booking-form' },
      { title:'üìÖ November 2025 (Group)', price:'Discount available',  note:'1 Nov departure ¬∑ Flexible dates', ctaText:'Reserve', ctaHref:'#booking-form' },
      { title:'‚≠ê Custom / Private Umrah', price:'Tailored Itinerary', note:'Premium hotel ¬∑ Private transport', ctaText:'Call for Plan', ctaHref:'#booking-form' },
      { title:'üõ´ Air Ticket & Visa Assist', price:'JED / MED',       note:'Multiple airlines ¬∑ Quick processing', ctaText:'Get Quote', ctaHref:'#booking-form' },
    ];

    // -------- Helpers ----------
    const $ = s => document.querySelector(s);
    function read(key, fallback){ try{ const x=JSON.parse(localStorage.getItem(key)); return Array.isArray(x)?x:fallback }catch{ return fallback } }
    function write(key, val){ localStorage.setItem(key, JSON.stringify(val)); }
    function ping(){ localStorage.setItem('ifaz_last_saved', String(Date.now())); } // let other tabs update

    // -------- State ----------
    let promos = read(PROMO_KEY, defaultPromos.slice());
    let pkgs   = read(PKG_KEY,   defaultPackages.slice());

    // -------- Promo table ----------
    const promoTBody = $('#promoTable tbody');
    function renderPromos(list){
      promoTBody.innerHTML = '';
      list.forEach((p, i)=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><input type="text" value="${p.title||''}" data-k="title"></td>
          <td><input type="text" value="${p.subtitle||''}" data-k="subtitle"></td>
          <td><input type="text" value="${p.badge||''}" data-k="badge"></td>
          <td>
            <select data-k="theme">
              ${['sky','blue','rose','amber','green','lime'].map(t=>`<option ${p.theme===t?'selected':''}>${t}</option>`).join('')}
            </select>
          </td>
          <td><input type="url" value="${p.href||''}" data-k="href" placeholder="https:// or page.html"></td>
          <td class="row-actions">
            <button class="btn" data-act="up">‚Üë</button>
            <button class="btn" data-act="down">‚Üì</button>
            <button class="btn danger" data-act="del">Delete</button>
          </td>
        `;
        promoTBody.appendChild(tr);

        tr.querySelectorAll('input,select').forEach(inp=>{
          inp.addEventListener('input', ()=>{
            list[i][inp.dataset.k] = inp.value;
          });
        });
        tr.querySelector('[data-act="up"]').onclick   = ()=>{ if(i>0){ [list[i-1],list[i]]=[list[i],list[i-1]]; renderPromos(list) } };
        tr.querySelector('[data-act="down"]').onclick = ()=>{ if(i<list.length-1){ [list[i+1],list[i]]=[list[i],list[i+1]]; renderPromos(list) } };
        tr.querySelector('[data-act="del"]').onclick  = ()=>{ list.splice(i,1); renderPromos(list) };
      });
    }

    // -------- Packages table ----------
    const pkgTBody = $('#pkgTable tbody');
    function renderPkgs(list){
      pkgTBody.innerHTML = '';
      list.forEach((p, i)=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><input type="text" value="${p.title||''}" data-k="title"></td>
          <td><input type="text" value="${p.price||''}" data-k="price"></td>
          <td><input type="text" value="${p.note||''}" data-k="note"></td>
          <td><input type="text" value="${p.ctaText||''}" data-k="ctaText"></td>
          <td><input type="text" value="${p.ctaHref||''}" data-k="ctaHref"></td>
          <td class="row-actions">
            <button class="btn" data-act="up">‚Üë</button>
            <button class="btn" data-act="down">‚Üì</button>
            <button class="btn danger" data-act="del">Delete</button>
          </td>
        `;
        pkgTBody.appendChild(tr);

        tr.querySelectorAll('input').forEach(inp=>{
          inp.addEventListener('input', ()=>{
            list[i][inp.dataset.k] = inp.value;
            renderPkgPreview(list);
          });
        });
        tr.querySelector('[data-act="up"]').onclick   = ()=>{ if(i>0){ [list[i-1],list[i]]=[list[i],list[i-1]]; renderPkgs(list); renderPkgPreview(list); } };
        tr.querySelector('[data-act="down"]').onclick = ()=>{ if(i<list.length-1){ [list[i+1],list[i]]=[list[i],list[i+1]]; renderPkgs(list); renderPkgPreview(list); } };
        tr.querySelector('[data-act="del"]').onclick  = ()=>{ list.splice(i,1); renderPkgs(list); renderPkgPreview(list); };
      });
    }

    // -------- Package small preview ----------
    const pkgPreview = $('#pkgPreview');
    function renderPkgPreview(list){
      pkgPreview.innerHTML = '';
      list.forEach(p=>{
        const el = document.createElement('div');
        el.className = 'pkg-card';
        el.innerHTML = `
          <h4>${p.title||''}</h4>
          <div class="price">${p.price||''}</div>
          <div class="note">${p.note||''}</div>
          <button class="btn">${p.ctaText||'Details'}</button>
        `;
        pkgPreview.appendChild(el);
      });
    }

    // -------- Init renders ----------
    renderPromos(promos);
    renderPkgs(pkgs);
    renderPkgPreview(pkgs);

    // -------- Buttons ----------
    $('#addPromo').onclick  = ()=>{ promos.push({title:'New promo',subtitle:'',badge:'',theme:'sky',href:'#'}); renderPromos(promos) };
    $('#resetPromo').onclick= ()=>{ promos = defaultPromos.slice(); renderPromos(promos); };
    $('#savePromo').onclick = ()=>{
      write(PROMO_KEY, promos);
      ping();
      alert('‚úÖ Promos saved');
      // re-render preview with latest data (promo.js reads from LS on load)
      location.reload();
    };

    $('#addPkg').onclick    = ()=>{ pkgs.push({title:'New package',price:'',note:'',ctaText:'Details',ctaHref:'#'}); renderPkgs(pkgs); renderPkgPreview(pkgs); };
    $('#resetPkg').onclick  = ()=>{ pkgs = defaultPackages.slice(); renderPkgs(pkgs); renderPkgPreview(pkgs); };
    $('#savePkg').onclick   = ()=>{ write(PKG_KEY, pkgs); ping(); alert('‚úÖ Packages saved'); };

    // -------- Logout ----------
    $('#logoutBtn').onclick = ()=>{ localStorage.removeItem('ifaz_auth'); location.href='index.html'; };
  </script>
</body>
</html>
